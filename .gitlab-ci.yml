stages:
  - test
  - coverage
  - deploy

junit:
  stage: test
  script:
    - ./gradlew test

generate_artifacts:
  stage: deploy
  script:
    - ./gradlew clean jar
  artifacts:
    paths:
      - build/libs/seng202.team5.App.jar

test_coverage:
  stage: coverage
  script:
    - ./gradlew test jacocoTestReport
    - echo "Coverage report generated"
    - grep -o '<td class="ctr2">[0-9]*%</td>' app/build/jacocoHtml/index.html | head -1 | grep -o '[0-9]*%' | sed 's/%/ percent/' || echo "0 percent"
  coverage: '/(\d+) percent/'
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: app/build/reports/jacoco/test/jacocoTestReport.xml
    paths:
      - app/build/jacocoHtml/
    expire_in: 30 days
  allow_failure: false
