junit:
  stage: test
  script:
    - ./gradlew test

generate_artifacts:
  stage: deploy
  script:
    - ./gradlew clean jar
  artifacts:
    paths:
      - build/libs/seng202.team5.App.jar

test_coverage:
  stage: coverage
  script:
    - ./gradlew test jacocoTestReport
    - cat app/build/reports/jacoco/test/html/index.html | grep -o 'Total[^%]*%' | sed 's/Total.*>\([0-9]*\)%.*/\1/' || echo "Coverage parsing failed"
  coverage: "/Total.*?([0-9]{1,3})%/"
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: app/build/reports/jacoco/test/jacocoTestReport.xml
    paths:
      - app/build/reports/jacoco/test/html/
    expire_in: 30 days
